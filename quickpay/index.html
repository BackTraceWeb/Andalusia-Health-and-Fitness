<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Andalusia Health & Fitness — Get fit & healthy</title>
  <link rel="stylesheet" href="/styles.css"/>

  <meta name="description" content="Andalusia Health & Fitness — 24/7 gym in Andalusia, AL. Join online.">
</head>
<body class="theme-andalusia">
 <!-- Topbar -->
<div class="topbar">
  <div class="shell">
    <div class="brand-pill">
      <a href="index.html"><img src="/AHFlogo.png" alt="Andalusia Health & Fitness"></a>
    </div>

    <nav class="mainnav">
      <a href="/index.html" class="active">Home</a>
      <a href="/pricing.html">Pricing</a>
      <a href="https://maps.google.com/?q=205+Church+St,+Andalusia,+AL+36420" target="_blank" rel="noopener">Location</a>
    </nav>
  </div>
</div>

<main class="shell qp-wrap">
  <h1>QuickPay</h1>
  <section class="card" style="max-width:340px; margin:auto; padding:1.25rem 1rem;">
    <p class="qp-intro">Enter your name to look up your membership and pay securely.</p>
    <form id="lookupForm" onsubmit="return false;" class="stack">
      <div class="qp-grid">
        <label>
          <span>First name</span>
          <input id="first" name="first" type="text" autocomplete="given-name" required>
        </label>
        <label>
          <span>Last name</span>
          <input id="last" name="last" type="text" autocomplete="family-name" required>
        </label>
      </div>

        <div class="row" style="gap:.75rem; align-items:center; margin-top:1rem;">
          <button id="lookupBtn" type="button" class="pill-cta">Find my invoice</button>
          <span id="lookupSpin" style="display:none;">Looking up…</span>
        </div>

        <div id="resultBox" class="qp-status" style="display:none"></div>

        <!-- Enabled only when a due invoice is found -->
        <div id="payFormWrap" style="margin-top:1rem;">
          <form id="payForm" action="/api/payments/hosted-start.php" method="post">
            <input type="hidden" name="memberId" id="memberId">
            <input type="hidden" name="invoiceId" id="invoiceId">
            <button id="payBtn" type="submit" class="pill-cta" disabled>Pay securely</button>
            <small>You’ll be redirected to our secure payment page.</small>
            <div style="margin-top:0.5rem; color:#888; font-size:0.95em;">
              For issues with QuickPay, please call <a href="tel:3345822000" style="color:inherit;text-decoration:underline;">334&nbsp;582&nbsp;2000</a>.
            </div>
          </form>
        </div>
      </form>
    </section>

   
  </main>

  <!-- Optional: site footer could be copied from your other pages -->

  <script>
    const $ = s => document.querySelector(s);
    const elFirst = $('#first'), elLast = $('#last');
    const elLookupBtn = $('#lookupBtn'), elSpin = $('#lookupSpin');
    const elBox = $('#resultBox'), elPayBtn = $('#payBtn');
    const elMemberId = $('#memberId'), elInvoiceId = $('#invoiceId');

    function setStatus(msg, tone=''){
      elBox.style.display='block';
      elBox.className='qp-status ' + (tone ? 'qp-' + tone : '');
      elBox.innerHTML=msg;
    }

    async function doLookup(){
      const first=(elFirst.value||'').trim();
      const last =(elLast.value||'').trim();
      if(!first || !last){ setStatus('Please enter both first and last name.','warn'); return; }

      elLookupBtn.disabled=true; elPayBtn.disabled=true; elSpin.style.display='inline';
      setStatus('Looking up your account…');

      try{
        const qs=new URLSearchParams({first,last});
        const res=await fetch('/api/quickpay/lookup.php?'+qs.toString(),{credentials:'same-origin'});
        if(!res.ok) throw new Error('HTTP '+res.status);
        const data=await res.json();

        if(data.status==='not_found' || !data.member){
          setStatus('We couldn’t find a matching account. Please check your spelling or contact the front desk.','warn');
          return;
        }

        const m=data.member;
        if(data.status==='due' && data.invoice){
          const cents=parseInt(data.invoice.amount_cents,10)||0;
          const amount='$'+(cents/100).toFixed(2);
          setStatus(`<strong>${m.first_name} ${m.last_name}</strong> found.<br>
                     Amount due: <strong>${amount}</strong><br>
                     <small>Period ${data.invoice.period_start??''} – ${data.invoice.period_end??''}</small>`, 'ok');
          elMemberId.value=m.id;
          elInvoiceId.value=data.invoice.id;
          elPayBtn.disabled=false;
        } else {
          setStatus(`<strong>${m.first_name} ${m.last_name}</strong> found.<br>No payment is due right now.`, 'ok');
          elPayBtn.disabled=true;
        }
      } catch(e){
        console.error(e);
        setStatus('Sorry, something went wrong. Please try again shortly.','err');
      } finally {
        elLookupBtn.disabled=false; elSpin.style.display='none';
      }
    }

    elLookupBtn.addEventListener('click', doLookup);
    elLast.addEventListener('keydown', e => { if(e.key==='Enter'){ e.preventDefault(); doLookup(); }});
  </script>
</body>
</html>
